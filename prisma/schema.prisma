generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // reviews the user has created
  createdReviews PerformanceReview[] @relation("CreatedReviews")
  // review the user has received
  receivedReview PerformanceReview?  @relation("ReceivedReview")
  // reviews the user has been asked to provide feedback on
  assignments    Assignment[]
}

model PerformanceReview {
  id        String   @id @default(cuid())
  title     String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reviewer    User         @relation("CreatedReviews", fields: [reviewerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  reviewerId  String
  reviewee    User         @relation("ReceivedReview", fields: [revieweeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  revieweeId  String       @unique
  assignments Assignment[]
}

model Assignment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  review       PerformanceReview @relation(fields: [reviewId], references: [id])
  reviewId     String
  assignedTo   User              @relation(fields: [assignedToId], references: [id])
  assignedToId String
  feedback     Feedback?
}

model Feedback {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  assignmentId String     @unique
}
